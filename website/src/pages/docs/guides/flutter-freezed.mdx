import { PackageCmd, Callout } from '@theguild/components'

# Guide: Dart/Flutter

Boost 🚀 your development of Dart/Flutter apps using a GraphQL API by generating models directly from your GraphQL Schema.

Currrently this plugin only generates [Freezed](https://pub.dev/packages/freezed) models but work is ongoing to make it way easier to work with GraphQL by scaffolding an entire GraphQL client with support for Queries, Mutations and Subscriptions taking huge inspiration from [KitQL]()

## TL;DR

The `flutter-freezed` plugin generates [Freezed](https://pub.dev/packages/freezed) models from a GraphQL Schema.

## Motivation

> Dart is awesome, but defining a "model" can be tedious. We may have to:
>
> - define a constructor + the properties
> - override toString, operator ==, hashCode
> - implement a copyWith method to clone the object
> - handling de/serialization
>
> On top of that, Dart is also missing features such as union types and pattern-matching.
>
> Implementing all of this can take hundreds of lines, which are error-prone and the readability of your model significantly.
>
> Freezed tries to fix that by implementing most of this for you, allowing you to focus on the definition of your model.
> https://pub.dev/packages/freezed

Fortunately enough, GraphQL is strongly typed, and so is Dart.
Save yourself from implementing a model to match your strongly typed GraphQL types, and let [Freezed](https://pub.dev/packages/freezed) handle the work while you chill with this `flutter-freezed`plugin

## Features

Currently, the plugin supports the following features

- [x] Generate Freezed classes for ObjectTypes
- [x] Generate Freezed classes for InputTypes
- [x] Support for EnumsTypes
- [x] Support for custom ScalarTypes
- [x] Support freeze documentation of class & properties from GraphQL SDL description comments
- [x] Ignore/don't generate freezed classes for certain ObjectTypes
- [x] Support directives
- [x] Support deprecation annotation
- [x] ~~Support for InterfaceTypes~~
- [x] Support for UnionTypes [union/sealed classes](https://pub.dev/packages/freezed#unionssealed-classes)
- [x] Merge InputTypes with ObjectType as union/sealed class [union/sealed classes](https://pub.dev/packages/freezed#unionssealed-classes)

## TODO:

- [ ] Support Queries, Mutations, and Subscription: make it way easier to use GraphQL in flutter without going through any complex process. Inspired by [KitQL](https://www.kitql.dev/)

## Demo

Given the following GraphQL schema:

```graphql
input RequestOTPInput {
  email: String
  phoneNumber: String
}

input VerifyOTPInput {
  email: String
  phoneNumber: String
  otpCode: String!
}

union AuthWithOTPInput = RequestOTPInput | VerifyOTPInput
```

Using the following config:

```yaml
schema: demo-schema.graphql
generates:
  ./lib/data/models/app_models.dart:
    plugins:
      - flutter-freezed
```

This is the generated output:

```dart
import 'package:freezed_annotation/freezed_annotation.dart';
import 'package:flutter/foundation.dart';

part app_models.dart;
part 'app_models.g.dart';

@unfreezed
class RequestOtpInput with _$RequestOtpInput {
  const RequestOtpInput._();

  const factory RequestOtpInput({
    String? email,
    String? phoneNumber,
  }) = _RequestOtpInput;

  factory RequestOtpInput.fromJson(Map<String, Object?> json) => _RequestOtpInputFromJson(json);
}

@unfreezed
class VerifyOtpInput with _$VerifyOtpInput {
  const VerifyOtpInput._();

  const factory VerifyOtpInput({
    String? email,
    String? phoneNumber,
    required String otpCode,
  }) = _VerifyOtpInput;

  factory VerifyOtpInput.fromJson(Map<String, Object?> json) => _VerifyOtpInputFromJson(json);
}

@freezed
class AuthWithOtpInput with _$AuthWithOtpInput {
  const AuthWithOtpInput._();

  const factory AuthWithOtpInput() = _AuthWithOtpInput;

  const factory AuthWithOtpInput.requestOtpInput({
    String? email,
    String? phoneNumber,
  }) = RequestOtpInput;

  const factory AuthWithOtpInput.verifyOtpInput({
    String? email,
    String? phoneNumber,
    required String otpCode,
  }) = VerifyOtpInput;

  factory AuthWithOtpInput.fromJson(Map<String, Object?> json) => _AuthWithOtpInputFromJson(json);
}
```

## Getting started

To get started, make sure you have the following installed:

- Node.js (10 or later)
- NPM or Yarn

Follow the [Installation Guide](/docs/getting-started/installation) for more details on getting started with GraphQL Code Generator

Inside your Flutter project root folder:

1. Install [freezed](https://pub.dev/packages/freezed#install) in your flutter project

2. Install [json_serializable](https://pub.dev/packages/json_serializable) in your flutter project

3. Download your GraphQL schema in graphql format and place it at the root of your Flutter project

```sh
npm install -g graphqurl

gq < graphql-endpoint > --introspect > schema.graphql

# if your graphql endpoint requires authentication:
gq < graphql-endpoint > -H "Authorization: Bearer <token>" --introspect > schema.graphql
```

4. Add the following to the `.gitignore` file:

```
# graphql-code-generator related
node_modules/
```

5. Create a `package.json` file at the root of the Flutter project with the following:

```json
{
  "name": "GraphQL Code Generator Flutter Freezed",
  "version": "1.0.0",
  "scripts": {
    "flutter-freezed": "graphql-codegen"
  }
}
```

6. Install the `graphql-code-generator` and the `flutter-freezed` plugin

<PackageCmd packages={['graphql', '-D typescript', '-D @graphql-codegen/cli @graphql-codegen/flutter-freezed']} />

7. Create a `codegen.yml` file at the root of the Flutter project with the following:

```yaml
schema: './schema.graphql'
generates:
  ./lib/data/models/app_models.dart:
    plugins:
      - flutter-freezed
```

8. Generate your freezed models with the following command and chill 🍻:

```bash
npm run flutter-freezed
```

## PRs are welcomed

This started as a plugin but eventually we hope to make it way easier to use GraphQL in your Flutter apps.

For more advanced configuration, please refer to the [plugin documentation](/plugins/dart/flutter-freezed).

For a different organization of the generated files, please refer to the ["Generated files colocation"](/docs/advanced/generated-files-colocation) page.


> get-graphql-schema https://demo.saleor.io/graphql/ > schema.graphql

@name Pattern

@description A compact string of patterns used in the config for granular configuration for each Graphql Type and/or its fieldNames

The string can contain more than one pattern, each pattern ends with a semi-colon (`;`).

A dot (`.`) separates the TypeName from the FieldNames in each pattern

To apply an option to all Graphql Types or fields, use the allTypeNames (`@*TypeNames`) and allFieldNames (`@*FieldNames`) tokens respectively

Wherever you use the allTypeNames and the allFieldNames, know very well that you can make some exceptions. After all, to every rule, there is an exception

A **square bracket** (`[]`) is used to specify what should be included and a **negated square bracket** (`-[]`) is used to specify what should be excluded

Manually typing out a pattern may be prone to typos and invalid patterns therefore the [`TypeFieldName`]() class exports some builder methods which you can use in your plugin config file.

The patterns themselves are readable and easy to manually type it out in the config but its RECOMMENDED that you use the builder methods. However, along with builder methods, the [`TypeFieldName`]() class also exports the Regular Expression(RegExp) used to test the patterns for a match as well as matcher methods. You can use these to find out if you manually typed out patterns would work with this plugin.

@exampleMarkdown

## Usage for Graphql Types

### Configuring specific Graphql Types

You can explicitly list out the names of the Graphql Types that you want to configure.

```ts
const pattern = Pattern.forTypeNames([Droid, Starship]);
console.log(pattern); // "Droid;Starship;"
```

### Configuring all Graphql Types

Instead of manually listing out **all** the types in the Graphql Schema, use the allTypeNames (`@*TypeNames`) to configure all the Graphql Types in the Schema

```ts
const pattern = Pattern.forAllTypeNames();
console.log(pattern); // "@*TypeNames;"
```

### Configuring all Graphql Types except those specified in the exclusion list of TypeNames

You can configure all GraphQL Types except those specified.

The example below configures all the Graphql Types in the Schema except the `Droid` and `Starship` Graphql Types

```ts
const pattern = Pattern.forAllTypeNamesExcludeTypeNames([Droid, Starship]);
console.log(pattern); // "@*TypeNames-[Droid,Starship];"
```

## Usage for fields of Graphql Types

### Configuring specific fields of a specific Graphql Type

You can explicitly list out the names of the fields of the Graphql Types that you want to configure.

```ts
const pattern = Pattern.forFieldNamesOfTypeName([
  [Droid, [id, name, friends]], // individual
  [Human, [id, name, title]], // individual
  [Starship, [name, length]], // individual
]);
console.log(pattern); // "Droid.[id,name,friends];Human.[id,name,title];Starship.[name,length];"
```

### Configuring all fields of a specific Graphql Type

Instead of manually listing out **all the fields** of the Graphql Type, use the allFieldNames (`@*FieldNames`) to configure all the fields of the Graphql Type.

```ts
const pattern = Pattern.forAllFieldNamesOfTypeName([Droid, Movie]);
console.log(pattern); // "Droid.@*FieldNames;Movie.@*FieldNames;"
```

### Configuring all fields except those specified in the exclusion list of FieldNames for a specific GraphQL Type

In the example below, the `id` and the `name` fields will be excluded from the configuration while all the remaining fields of the `Droid` Graphql Type will be configured

```ts
const pattern = Pattern.forAllFieldNamesExcludeFieldNamesOfTypeName([
  [Droid, [id, name, friends]], // individual
  [Human, [id, name, title]], // individual
  [Starship, [name, length]], // individual
]);
console.log(pattern); // "Droid.@*FieldNames-[id,name,friends];Human.@*FieldNames-[id,name,title];Starship.@*FieldNames-[name,length];"
```

### Configuring specific fields of all Graphql Types

When you use the allTypeNames (`@*TypeNames`), you can specify the fields to be configured. If field name that doesn't exists for a given Graphql Type, it would simply be ignored.

The example below configures the `id` and `name` fields of all Graphql Types

```ts
const pattern = Pattern.forFieldNamesOfAllTypeNames([id, name, friends]);
console.log(pattern); // "@*TypeNames.[id,name,friends];"
```

### Configuring all fields of all Graphql Types

Using the allFieldNames (`@*FieldNames`) on the allTypeNames (`@*TypeNames`), you can configure all fields of all the Graphql Types in the Schema

```ts
const pattern = Pattern.forAllFieldNamesOfAllTypeNames();
console.log(pattern); // "@*TypeNames.@*FieldNames;"
```

### Configuring all fields except those specified in the exclusion list of FieldNames for all GraphQL Types

As always, you can make some exception when you use the allFieldNames (`@*FieldNames`) to except some fields from the configuration.

In the example below, the `id` and the `name` fields will be excluded from the configuration while all the remaining fields of all Graphql Type will be configured

```ts
const pattern = Pattern.forAllFieldNamesExcludeFieldNamesOfAllTypeNames([id, name, friends]);
console.log(pattern); // "@*TypeNames.@*FieldNames-[id,name,friends];"
```

### Configuring specific fields of all GraphQL Types except those specified in the exclusion list of TypeNames

In the example below, the `id` and `name` fields will be configured for all the Graphql Types in the Schema except`Droid` and `Starship`

```ts
const pattern = Pattern.forFieldNamesOfAllTypeNamesExcludeTypeNames([Droid, Human], [id, name, friends]);
console.log(pattern); // "@*TypeNames-[Droid,Human].[id,name,friends];"
```

### Configuring all fields of all GraphQL Types except those specified in the exclusion list of TypeNames

In the example below, all fields of all Graphql Types in the Schema except for the fields of `Droid` and `Starship` will be excluded from the configuration while all the remaining fields of all Graphql Type will be configured

```ts
 * const pattern = Pattern.forAllFieldNamesOfAllTypeNamesExcludeTypeNames([Droid, Human]);
 * console.log(pattern); // "@*TypeNames-[Droid,Human].@*FieldNames;"
```

### Configuring all fields except those specified in the exclusion list of FieldNames of all GraphQL Types except those specified in the exclusion list of TypeNames

In the example below, the `id` and the `name` fields of `Droid` or `Starship` will be excluded from the configuration while all the **remaining fields** of all Graphql Types(including `Droid` and `Starship`) will be configured

```ts
const pattern = Pattern.forAllFieldNamesExcludeFieldNamesOfAllTypeNamesExcludeTypeNames(
  [Droid, Human],
  [id, name, friends]
);
console.log(pattern); // "@*TypeNames-[Droid,Human].@*FieldNames-[id,name,friends];"
```
